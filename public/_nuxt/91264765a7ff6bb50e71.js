(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{405:function(t,e,n){},406:function(t,e,n){"use strict";n(37),n(192),n(74),n(64),n(73);var r,o,c,l=n(140),m=(n(105),n(72),n(18)),d=n(35),h=n.n(d),f={props:["formData"]},v=(n(426),n(15)),_={props:["flag","data"],components:{editForm:Object(v.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.title,expression:"formData.title"}],staticClass:"title",attrs:{type:"text",placeholder:"제목을 입력해주세요."},domProps:{value:t.formData.title},on:{input:function(e){e.target.composing||t.$set(t.formData,"title",e.target.value)}}}),t._v(" "),n("vue-editor",{model:{value:t.formData.contents,callback:function(e){t.$set(t.formData,"contents",e)},expression:"formData.contents"}})],1)}),[],!1,null,"5532f4c0",null).exports},data:function(){return{loading:!1,formData:{title:this.data?this.data.title:"",contents:this.data?this.data.contents:""},mode:this.data?"edit":"create",init:!1,formImage:[],mainImageFixFlag:!1,mainImageFile:""}},methods:{onFileChange:function(t){var e=t.target.files||t.dataTransfer.files;this.mainImageFile=e&&e.length?e[0]:""},replaceContentsImage:(c=Object(m.a)(regeneratorRuntime.mark((function t(){var e,n,img,r,o,c,m,d,h,f,v,_;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(_=function(t,e){for(var n=t.split(","),r=n[0].match(/:(.*?);/)[1],o=atob(n[1]),c=o.length,l=new Uint8Array(c);c--;)l[c]=o.charCodeAt(c);return new File([l],e,{type:r})},e=this.formData.contents,n=/<(\img)([^>]*)>/gi,img=e.match(n),r=[],!(img&&img.length>0)){t.next=31;break}for(o=document.createElement("div"),c=0;c<img.length;c+=1)o.innerHTML+=img[c];m=o.getElementsByTagName("img"),d=Object(l.a)(m).map((function(t){return t.currentSrc})),h=0;case 11:if(!(h<d.length)){t.next=29;break}if(!this.isBase64(d[h])){t.next=24;break}return f=_(d[h],Date.now()),t.next=16,this.uploadImage(f,f.name);case 16:return t.next=18,this.getImageUrl(f.name);case 18:v=t.sent,r.push({name:f.name,url:v}),e=e.replace(d[h],v),this.formImage.push(v),t.next=26;break;case 24:e=e.replace(d[h],d[h]),this.formImage.push(d[h]);case 26:h+=1,t.next=11;break;case 29:t.next=32;break;case 31:e=this.formData.contents;case 32:return t.abrupt("return",new Promise((function(t){t({data:e,cdnUrl:r})})));case 33:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)}),getImageUrl:function(t){return h.a.storage().ref().child("images/".concat(this.flag,"/").concat(t)).getDownloadURL()},uploadImage:function(t,e){return h.a.storage().ref().child("images/".concat(this.flag,"/").concat(e)).put(t)},isBase64:function(t){return/data:image\/([a-zA-Z]*);base64,([^\"]*)/g.test(t)},removeImage:(o=Object(m.a)(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=h.a.storage().ref()).child("images/".concat(this.flag,"/").concat(e))){t.next=6;break}return t.next=4,n.child("images/".concat(this.flag,"/").concat(e)).delete();case 4:t.next=7;break;case 6:case 7:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)}),submit:(r=Object(m.a)(regeneratorRuntime.mark((function t(){var e,n,r,o,c,l,m,d,f,v=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=h.a.firestore(),!this.formData.title&&!this.formData.contents){t.next=22;break}if(this.loading=!0,n=e.collection(this.flag).doc().id,r={title:this.formData.title,contents:"",imgArr:[],writer:"kingsjw7",date:new Date},!this.mainImageFile){t.next=14;break}return o=Date.now(),t.next=9,this.uploadImage(this.mainImageFile,o);case 9:return t.t0=o,t.next=12,this.getImageUrl(o);case 12:t.t1=t.sent,r.mainImage={name:t.t0,url:t.t1};case 14:return t.next=16,this.replaceContentsImage();case 16:if(c=t.sent,r.contents=c.data,"create"===this.mode)c.cdnUrl&&c.cdnUrl.length>0&&(r.imgArr=c.cdnUrl),e.collection(this.flag).doc(n).set(r).then((function(){console.log("Document successfully write!")})).catch((function(t){console.log(t)})),this.$emit("getData"),setTimeout((function(){v.$router.push("/".concat(v.flag))}),300);else{if(r.imgArr=c.cdnUrl&&c.cdnUrl.length>0?c.cdnUrl:this.data.imgArr,this.mainImageFile&&this.data&&this.data.mainImage&&this.removeImage(this.data.mainImage.name),this.formImage&&this.formImage.length>0){for(l=[],m=[],this.data.imgArr.forEach((function(t){-1===v.formImage.indexOf(t.url)?l.push(t):m.push(t)})),d=0;d<l.length;d+=1)this.removeImage(l[d].name);r.imgArr=m}else{for(f=0;f<this.data.imgArr.length;f+=1)this.removeImage(this.data.imgArr[f].name);r.imgArr=[]}e.collection(this.flag).doc(this.data.id).update(r).then((function(){console.log("Document successfully update!"),v.$emit("getData"),setTimeout((function(){v.$router.push("/".concat(v.flag))}),300)})).catch((function(t){console.error("Error writing document: ",t),alert("실패")}))}this.loading=!1,t.next=23;break;case 22:alert("다 입력해야지 ㅡㅡ");case 23:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},mounted:function(){this.init=!0}},w=(n(427),Object(v.a)(_,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.init?n("div",{staticClass:"edit",class:t.$store.state.common.isMobile?"mobile":""},[n("editForm",{attrs:{formData:t.formData}}),t._v(" "),n("div",{staticClass:"mainImageSet"},[t.data&&t.data.mainImage&&t.data.mainImage.url?n("div",[t.mainImageFixFlag?n("div",[t._v("\n          메인 이미지(수정): "),n("input",{attrs:{type:"file"},on:{change:t.onFileChange}}),t._v(" "),n("span",{staticClass:"cancelBtn",on:{click:function(e){t.mainImageFixFlag=!1}}},[t._v("취소")])]):n("div",{staticClass:"mainImage",style:{backgroundImage:"url("+t.data.mainImage.url+")"}},[n("span",{staticClass:"fixBtn",on:{click:function(e){t.mainImageFixFlag=!0}}},[t._v("수정")])])]):n("div",[t._v("\n        메인 이미지:\n        "),n("input",{attrs:{type:"file"},on:{change:t.onFileChange}})])]),t._v(" "),n("button",{staticClass:"md-button success submit-btn",on:{click:t.submit}},[n("div",[t._v(t._s("create"===t.mode?"저장":"수정"))])]),t._v(" "),t.loading?n("div",{staticClass:"pop"},[n("div",{staticClass:"loading"})]):t._e()],1):t._e()}),[],!1,null,"341a860c",null));e.a=w.exports},407:function(t,e,n){"use strict";var r=n(405);n.n(r).a},408:function(t,e,n){},409:function(t,e,n){},410:function(t,e,n){},411:function(t,e,n){},412:function(t,e,n){},413:function(t,e,n){},421:function(t,e,n){"use strict";n(74);var r=n(423),o=(n(424),n(15)),c=Object(o.a)({},(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"list",class:this.$store.state.common.isMobile?"mobile":""},[this._m(0),this._v(" "),this._m(1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"thumbnail"},[e("div",{staticClass:"moveItem"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"info"},[e("div",{staticClass:"title"},[e("div",{staticClass:"moveItem"})]),this._v(" "),e("div",{staticClass:"writer"},[e("div",{staticClass:"moveItem"})])])])}],!1,null,"1c9b5137",null).exports;var l={postPageTitle:function(t){var title="";switch(t){case"travel":title="Travel is refresh";break;case"movie":title="Movie review";break;case"tech":title="Tech storage";break;default:title=""}return title}},m={props:["listData","loading"],data:function(){return{utils:l}},components:{list:r.a,listLoading:c},computed:{pageName:function(){return this.$route&&this.$route.path?this.$route.path.split("/")[1]:""},listing:function(){return this.listData&&this.listData.length>0?this.listData:this.$store.state.post&&this.$store.state.post[this.pageName]}},methods:{selectView:function(t){this.$emit("selectView",t)}},mounted:function(){this.$store.state.post[this.pageName]&&this.$store.state.post[this.pageName].length<=0&&this.$emit("getData")}},d=(n(425),Object(o.a)(m,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"postWrap",class:[t.$store.state.common.isMobile?"mobile":"",t.pageName]},[n("div",{staticClass:"wrap"},[n("p",{staticClass:"title"},[t._v(t._s(t.utils.postPageTitle(t.pageName)))]),t._v(" "),t.loading?n("div",{staticClass:"itemWrap"},t._l(3,(function(t){return n("listLoading",{key:t})})),1):n("div",{staticClass:"itemWrap"},t._l(t.listing,(function(e,r){return n("list",{key:r,class:e.type,attrs:{list:e},nativeOn:{click:function(n){return t.selectView(e.id)}}})})),1)])])}),[],!1,null,"1eb2375e",null));e.a=d.exports},422:function(t,e,n){"use strict";n(72);var r,o=n(18),c=(n(428),n(35)),l=n.n(c),m=n(406),d=(n(429),n(15)),h=Object(d.a)({},(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"listViewLoading",class:this.$store.state.common.isMobile?"mobile":""},[this._m(0),this._v(" "),this._m(1),this._v(" "),e("div",{staticClass:"contents"},this._l(5,(function(t){return e("div",{key:t,style:{width:(2*t>=5?5:2*t)+"0%"}},[e("div",{staticClass:"moveItem"})])})),0)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("div",[e("div",{staticClass:"moveItem"})])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"image"},[e("div",{staticClass:"moveItem"})])}],!1,null,"7708b3ac",null).exports,f={props:["flag"],head:function(){var t=this.listViewData&&this.listViewData.title;return{title:"".concat(t||"리뷰"),meta:[{hid:"description",name:"description",content:"kingsjw의 리뷰"},{hid:"og:image",name:"og:image",content:"https://firebasestorage.googleapis.com/v0/b/kingsjw7-f7e06.appspot.com/o/images%2Fflog.jpg?alt=media&token=5d7a96e9-b03a-47a9-a2ac-0267ca4a4939"},{hid:"og:title",name:"og:title",content:"".concat(t||"리뷰")},{hid:"og:description",name:"og:description",content:"kingsjw의 리뷰"}]}},components:{editForm:m.a,listViewLoading:h},data:function(){return{data:"",loading:!1,editMode:!1}},computed:{listViewData:function(){return this.data?this.data:this.$store.state.postView.data&&this.$store.state.postView.data[this.$route.query.id]}},mounted:(r=Object(o.a)(regeneratorRuntime.mark((function t(){var e,n,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=l.a.firestore(),this.loading=!0,void 0!==(this.$store.state.postView.data&&this.$store.state.postView.data[this.$route.query.id])){t.next=9;break}return t.next=5,e.collection(this.flag).doc(this.$route.query.id).get();case 5:n=t.sent,data=Object.assign({id:n.id},n.data()),this.data=data,this.$store.commit("postView/saveData",this.data);case 9:this.loading=!1;case 10:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},v=(n(430),Object(d.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"list-view",class:t.$store.state.common.isMobile?"mobile":""},[t.editMode?n("editForm",{attrs:{data:t.listViewData,flag:t.flag},on:{getData:function(e){return t.$emit("getData")}}}):n("div",[t.loading?n("listViewLoading"):n("div",{staticClass:"contents markdown-body",domProps:{innerHTML:t._s(t.listViewData&&t.listViewData.contents)}})],1),t._v(" "),n("div",{staticClass:"btn-wrap"},[t.$store.state.user.isLogin?n("button",{staticClass:"md-button success",on:{click:function(e){t.editMode=!t.editMode}}},[n("div",[t._v(t._s(t.editMode?"취소":"수정"))])]):t._e()])],1)}),[],!1,null,"a67420f8",null));e.a=v.exports},423:function(t,e,n){"use strict";var r={props:["list"]},o=(n(407),n(15)),component=Object(o.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"list",class:t.$store.state.common.isMobile?"mobile":""},[t.list&&t.list.mainImage&&t.list.mainImage.url?n("div",{staticClass:"thumbnail",style:{backgroundImage:"url("+t.list.mainImage.url+")"}}):n("div",{staticClass:"errorImage"}),t._v(" "),n("div",[n("div",{staticClass:"info"},[n("div",{staticClass:"title"},[t._v(t._s(t.list.title))]),t._v(" "),n("div",{staticClass:"writer"},[t._v("작성자: "+t._s(t.list.writer))])])])])}),[],!1,null,"03c13d7e",null);e.a=component.exports},424:function(t,e,n){"use strict";var r=n(408);n.n(r).a},425:function(t,e,n){"use strict";var r=n(409);n.n(r).a},426:function(t,e,n){"use strict";var r=n(410);n.n(r).a},427:function(t,e,n){"use strict";var r=n(411);n.n(r).a},428:function(t,e,n){},429:function(t,e,n){"use strict";var r=n(412);n.n(r).a},430:function(t,e,n){"use strict";var r=n(413);n.n(r).a}}]);